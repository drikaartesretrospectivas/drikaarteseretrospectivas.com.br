<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>Lucca 2 Anos</title>
    <style>
        :root { --accent: #25D366; --record: #ff0000; --boom: #e1306c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #000; color: #fff; overflow: hidden; width: 100vw; height: 100dvh; font-family: sans-serif; }
        
        /* Container Principal */
        .stage { position: relative; width: 100%; height: 100%; background: #000; }
        
        /* C√¢mera e Moldura */
        #camera { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        #moldura { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 5; pointer-events: none; display: none; }
        
        /* Camada de Interface (Bot√µes) */
        .ui-layer { position: absolute; inset: 0; z-index: 10; pointer-events: none; display: none; }
        
        /* Bot√£o Inverter (Topo) */
        .top-bar { position: absolute; top: 40px; left: 20px; pointer-events: auto; }
        .btn-ui { padding: 10px 20px; background: rgba(0,0,0,0.6); border: 1px solid #fff; border-radius: 20px; color: #fff; font-weight: bold; }

        /* Coluna de Bot√µes na Direita */
        .side-bar { 
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%); 
            display: flex; flex-direction: column; gap: 20px; align-items: center; pointer-events: auto; 
        }

        .btn-side { width: 55px; height: 55px; border-radius: 50%; border: 2px solid #fff; background: rgba(255,255,255,0.2); font-size: 24px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; text-decoration: none; }
        .btn-main { width: 75px; height: 75px; border: 4px solid #fff; background: rgba(255,255,255,0.1); }
        .btn-boom { border-color: var(--boom); color: #fff; }

        /* Capa Inicial */
        #startScreen { position: absolute; inset: 0; background: #000 url('capajpg.jpg') center/cover no-repeat; z-index: 100; display: flex; align-items: center; justify-content: center; }
        #startBtn { padding: 25px 55px; font-size: 24px; font-weight: bold; border: none; background: #FF5722; color: #fff; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }

        /* Telas de Resultado e Edi√ß√£o (Simplificadas) */
        #resultUI { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 150; display: none; flex-direction: column; align-items: center; justify-content: center; gap: 20px; }
        .btn-res { width: 80%; padding: 20px; border-radius: 15px; border: none; font-size: 18px; font-weight: bold; color: white; cursor: pointer; text-align: center; text-decoration: none; }
    </style>
</head>
<body>

<div class="stage">
    <video id="camera" autoplay playsinline muted></video>
    <img id="moldura" src="moldura1.png" />

    <div class="ui-layer" id="cameraUI">
        <div class="top-bar">
            <button class="btn-ui" onclick="switchCamera()">üîÑ INVERTER</button>
        </div>
        <div class="side-bar">
            <button class="btn-side" onclick="openGallery()">üñºÔ∏è</button>
            <button class="btn-side btn-main" onclick="takePhoto()">üì∑</button>
            <button class="btn-side btn-main" onclick="toggleVideo()" id="videoBtn">üé•</button>
            <button class="btn-side btn-boom" onclick="startBoomerang()">‚àû</button>
        </div>
    </div>

    <div id="resultUI" id="resultUI">
        <h2 id="statusText">PRONTO!</h2>
        <a id="downloadBtn" class="btn-res" style="background: var(--accent);">üì• BAIXAR AGORA</a>
        <button class="btn-res" style="background: #444;" onclick="location.reload()">üîÑ VOLTAR</button>
    </div>

    <div id="startScreen" id="startScreen">
        <button id="startBtn" onclick="initApp()">INICIAR C√ÇMERA</button>
    </div>
</div>

<input type="file" id="fileInput" accept="image/*" style="display:none;" onchange="handleGallery(event)">
<canvas id="finalCanvas" style="display:none;"></canvas>

<script>
    let stream = null;
    let usingFrontCamera = true;
    const video = document.getElementById('camera');
    const cameraUI = document.getElementById('cameraUI');
    const startScreen = document.getElementById('startScreen');
    const moldura = document.getElementById('moldura');

    // 1. INICIAR O APP
    async function initApp() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: usingFrontCamera ? 'user' : 'environment' },
                audio: true
            });
            video.srcObject = stream;
            
            // S√≥ mostra a interface quando o v√≠deo realmente carregar
            video.onloadedmetadata = () => {
                startScreen.style.display = 'none';
                cameraUI.style.display = 'block';
                moldura.style.display = 'block';
            };
        } catch (err) {
            alert("N√£o foi poss√≠vel acessar a c√¢mera. Verifique se est√° em HTTPS e se deu permiss√£o.");
        }
    }

    // 2. INVERTER C√ÇMERA
    async function switchCamera() {
        usingFrontCamera = !usingFrontCamera;
        if(stream) stream.getTracks().forEach(track => track.stop());
        await initApp();
    }

    // 3. TIRAR FOTO (L√≥gica b√°sica para teste)
    function takePhoto() {
        const canvas = document.getElementById('finalCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1080;
        canvas.height = 1920;

        // Desenha C√¢mera
        ctx.save();
        if(usingFrontCamera) { ctx.translate(canvas.width, 0); ctx.scale(-1, 1); }
        ctx.drawImage(video, 0, 0, 1080, 1920);
        ctx.restore();

        // Desenha Moldura
        if (moldura.complete) ctx.drawImage(moldura, 0, 0, 1080, 1920);

        // Mostra Resultado
        const dataUrl = canvas.toDataURL('image/png');
        document.getElementById('downloadBtn').href = dataUrl;
        document.getElementById('downloadBtn').download = "foto_lucca.png";
        document.getElementById('resultUI').style.display = 'flex';
    }

    // Fun√ß√µes de suporte
    function openGallery() { document.getElementById('fileInput').click(); }
    function handleGallery(e) { alert("Imagem selecionada! Implementar ajuste..."); }
    function toggleVideo() { alert("Gravando v√≠deo..."); }
    function startBoomerang() { alert("Criando Boomerang..."); }

</script>
</body>
</html>
